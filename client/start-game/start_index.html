<html>
<head>
    <title>Exquisite Wrap: Start Game</title>
    <style>
        #startGameSuccess,
        #startGameError {
            display: none;
        }
    </style>
</head>
<body>
    <form id="startGameForm">
        <div>
            <label for="player1">Player 1 Phone:</label>
            <input type="tel" id="player1" name="player1" />
        </div>
        <div>
            <label for="player2">Player 2 Phone:</label>
            <input type="tel" id="player2" name="player2" />
        </div>
        <div>
            <label for="player3">Player 3 Phone:</label>
            <input type="tel" id="player3" name="player3" />
        </div>

        <div class="button">
            <button type="submit">Start</button>
        </div>
    </form>

    <div id="startGameSuccess">Game started!</div>
    <div id="startGameError">Error starting game!</div>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <script src="//wrap.co/widgets.js"></script>
    <script type="text/javascript">

        $(function() {
            var DALIBOT_API_URL = 'https://localhost:4444/api';
            var CREATE_GAME_URL = DALIBOT_API_URL + '/games';

            var $startGameForm = $('#startGameForm');
            var $startGameSuccess = $('#startGameSuccess');
            var $startGameError = $('#startGameError');

            wrap.initialize().then(function() {
                wrap.hideClickShield();
            })

            $startGameForm.submit(function(event) {
                event.preventDefault();

                var gameOptions = JSON.stringify({
                    players: $startGameForm.find('input').map(function() { return this.value; }).get()
                });

                $.ajax({
                    type: 'POST',
                    url: CREATE_GAME_URL,
                    headers: { 'Content-Type': 'application/json' },
                    data: gameOptions,
                    dataType: 'json'
                })
                    .done(function() { $startGameSuccess.toggle(); })
                    .fail(function() { $startGameError.toggle(); })
                    .always(function() { $startGameForm.toggle(); });
            });
        });

    </script>
</body>

</html>
